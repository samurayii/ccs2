# Обогащение файлов конфигурации

## Информация

При запросе файлов с сервера, тело файла проходит несколько этапов наполнения данными и трансформацию через `handlebars`.
Переменные сервера загружаются из источников указанных в секции файла настроек **key_stores**.

В запрашиваемых файлах переменные указываются между скобками **<<key:** и **>>**, если переменные имеют сложный путь, то вложенность обозначаются точкой. Переменные имеют префикс равный имени хранилища отделённой точкой, например: переменные хранилища **git1** имеют префикс `git1.`. Значение ключа в файлах перемененных могжет быть числом, строкой, объектом, массивом или логическое значение, так же можно как значение указать имя переменой операционной системы. Ключи значение который является объектом так же разбиваются на отдельные ключи в соответствии свой вложенности. Имена ключей ключей должны соответствовать регулярному выражению **^[a-zA-Z]{1}[-a-zA-Z0-9_]{0,31}$** Файл перемененных может быть двух типов **json** или **toml**. Помимо переменных хранилищ сервера, клиент также может прислать ключи, получить доступ к ним можно с помощью префикса `_client.`.

Также в запрашиваемых файлах можно указывать путь к вложенным файлам между скобками **<<file:[имя пространства]:** и **>>**, если пространство имён не указанно, то используется пространство в котором находится файл.

## Этапы наполнения

- Наполнение перемененными пространства имён.
- Наполнение перемененными клиента и пространства имён с префиксом.
- Наполнение вложенными файлами.
- Применение шаблонизатора `handlebars` [подробно](https://handlebarsjs.com/)

## Пример обогащения файла

### Файл config.toml

```toml
key1 = "<<key:git1.key1>>"
key2 = "<<key:_client.key1>>"
{{#if git1.keys.key1}}
key3 = 1
{{/if}}
{{#if git1.keys.key2}}
key3 = 2
{{/if}}
key4 = "{{git1.keys.key1}}"
key5 = <<file:namespace:/file1.txt>>
key5 = <<file:/file1.txt>>
```
